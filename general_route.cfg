route{
	$var(from_proxy) = ds_is_in_list("$si", "$sp");			#Ищем есть ли адрес/порт в списке
	$var(nolog) = 0;
	if ( ($var(from_proxy) == 1) && (is_method("OPTIONS")) ) {
		$var(nolog) = 1;
	}
	if ($var(nolog) == 0) xlog("L_INFO", "[MAIN] Incoming request (M=$rm IP=$si:$sp RURI=$ru DURI=$du F=$fu T=$tu oP=$oP pr=$pr dP=$dP rP=$rP ID=$ci cseq=$cs UA=$ua)n$mb");
	
	force_rport();			#Добавляем rport
	remove_hf("Path");		#Удаляем заголовок Path
	route(VALIDATE);
	route(PING);
	
	if (is_method("REGISTER")) {
		if (!add_path_received()) { 	# Добавление заголовка path с указанием from ip 
			xlog("L_ERR", "[MAIN] Cannot add path (M=$rm IP=$si:$sp RURI=$ru DURI=$du F=$fu T=$tu oP=$oP pr=$pr dP=$dP rP=$rP ID=$ci cseq=$cs UA=$ua)n");
			send_reply("503", "Internal Path Error");
			exit;
		}
		route(BALANCE);
		$avp(fr_timer) = 3;
		route(RELAY);
	}
}	
